{% extends "homepage/base.html" %}
{% load staticfiles %}

{% block user-info %}
    {% include "homepage/nav.html" %}
{% endblock %}

{% block content %}
    <script src="{% static 'js/jquery-2.1.1.min.js' %}"></script>
    <script>
        // construct the url with parameter values
        var apikey = "{{ api_key }}";
        var baseUrl = "http://data.tmsapi.com/v1.1";
        var showtimesUrl = baseUrl + '/movies/showings';
        var zipCode = "15213";
        var d = new Date();
        var today = d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate();

        $(document).ready(function () {
            // send off the query
            $.ajax({
                url: showtimesUrl,
                data: {
                    startDate: today,
                    zip: zipCode,
                    jsonp: "dataHandler",
                    api_key: apikey
                },
                dataType: "jsonp"
            });
        });

        // callback to handle the results
        function dataHandler(data) {
            // $(document.body).append('<p>Found ' + data.length + ' movies showing within 5 miles of ' + zipCode+':</p>');
            var count = 0;
            $.each(data, function (index, movie) {
                // var movieData = '<div class="tile"><img src="http://developer.tmsimg.com/' + movie.preferredImage.uri + '?api_key='+apikey+'"><br/>';
                var movieData = "<a href='#' class='collection-item'>" + movie.title + "(" + movie.ratings[0].code + ")</a>";
                $(document.getElementById("now-playing-movies")).append(movieData);
                if (count < 9) {
                    count++;
                } else {
                    return false;
                }
            });
        }

        /*
        window.onload = function () {
            var startPos;
            var geoSuccess = function (position) {
                startPos = position;
                document.getElementById('startLat').innerHTML = startPos.coords.latitude;
                document.getElementById('startLon').innerHTML = startPos.coords.longitude;
            };
            var geoError = function (error) {
                console.log('Error occurred. Error code: ' + error.code);
                // error.code can be:
                //   0: unknown error
                //   1: permission denied
                //   2: position unavailable (error response from location provider)
                //   3: timed out
            };
            navigator.geolocation.getCurrentPosition(geoSuccess, geoError);
        };
        */
    </script>


    <div class="card-panel z-depth-0">
        <div class="container">
            <div class="input-field">
                <form action="{% url 'movie:search' %}" method="get">
                    <i class="prefix material-icons">search</i>
                    <input type="text" class="col s6" name="movie" id="movie" placeholder="Find movies">
                </form>
            </div>
            <div id="now-playing-movies" class="collection with-header">
                <h5 class="collection-header">Now Playing</h5>
                <!--{% for movie in hits %}
                    <a href='#' class='collection-item'>{{ movie.title }} ({{ movie.ratings.0.code }})</a>
                {% endfor %}-->
            </div>
        </div>
    </div>

{% endblock %}
